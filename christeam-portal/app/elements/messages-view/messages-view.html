<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../../bower_components/iron-list/iron-list.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../bower_components/paper-material/paper-material.html">
<link rel="import" href="../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../../bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="../../bower_components/grapp-breadcrumbs/grapp-breadcrumbs.html">

<dom-module id="messages-view">
    <template>
        <style>
            :host {
                display: block;
            }

            iron-list {
                --iron-list-items-container: {
                    margin: auto;
                };
            }

            paper-material {
                @apply(--layout-flex);
                @apply(--layout-vertical);
                background-color: white;
                text-align: center;
                padding: 0 16px;
            }


            /*            .container {
                            @apply(--layout-horizontal);
                        }
                        .flexchild {
                            display: inline-block;
                            @apply(--layout-flex);
                        }
                        iron-list {
                             padding-top: 148px; 
                             margin-top: 64px; 
                            padding-bottom: 16px;
                        }
                        .item {
                            @apply(--layout-horizontal);
                            padding: 20px;
                            border-radius: 8px;
                            background-color: white;
                            border: 1px solid #ddd;
                             max-width: 800px; 
                            margin: 16px auto 0 auto;
                        }
                        .item:focus {
                            outline: 0;
                            border-color: #333;
                        }
            
                        .item.unread {
                            outline: 0;
                            background-color: #ddd;
                        }
            
                        .item.selected .star {
                            color: var(--paper-blue-600);
                        }
            
                        .item.selected {
                            background-color: var(--google-grey-300);
                            border-bottom: 1px solid #ccc;
                        }
            
                        .avatar {
                            height: 40px;
                            width: 40px;
                            border-radius: 20px;
                            box-sizing: border-box;
                            background-color: #DDD;
                        }
                        .pad {
                            padding: 0 16px;
                            @apply(--layout-flex);
                            @apply(--layout-vertical);
                        }
                        .primary {
                            font-size: 16px;
                            font-weight: bold;
                        }
                        .secondary {
                            font-size: 14px;
                        }
                        .dim {
                            color: gray;
                        }
                        .spacer {
                            @apply(--layout-flex);
                        }*/

        </style>

        <iron-ajax id="rootModelAjax"

                   url="{{apiUrl}}/content-management/toc/info" 
                   params="{{infoRequestParams}}"
                   handle-as="json"
                   last-response="{{rootModel}}" 
                   auto>

        </iron-ajax>

        <iron-ajax id="parentTocAjax"

                   url="{{apiUrl}}/content-management/toc/path" 
                   params="{{tocRequestParams}}"
                   handle-as="json"
                   last-response="{{parentModel}}" 
                   on-response="onParentTocResponse"
                   on-error="onParentTocError"
                   auto>

        </iron-ajax>

        <iron-ajax id="childTocAjax"
                   url="{{apiUrl}}/content-management/toc" 
                   params="{{tocRequestParams}}"
                   handle-as="json"
                   last-response="{{data}}" 
                   auto>

        </iron-ajax>

        <paper-tabs selected="{{selectedContentFolder}}">
            <paper-tab>Public</paper-tab>
            <paper-tab>Drafts</paper-tab>
            <paper-tab>Published</paper-tab>
        </paper-tabs>
        <iron-pages selected="{{selectedContentFolder}}">

            <div id="public">
                <!--        <template is="dom-repeat" items="{{parentModel.sections}}">
                            yyy
                            <grapp-breadcrumb href="{{baseUrl}}content-tree/{{item.data}}">[[item.key]]</grapp-breadcrumb>
                        <template is="dom-repeat" items="{{parentModel.sections}}">
                            yyy
                            <grapp-breadcrumb href="{{baseUrl}}content-tree/{{item.data}}">[[item.key]]</grapp-breadcrumb>
                        </template>-->

                <template is="dom-repeat" items="{{parentModel.sections}}">
                    <grapp-breadcrumb href="{{baseUrl}}content-tree/{{item.data}}">[[item.key]]</grapp-breadcrumb>
                </template>

                <!--        <grapp-breadcrumbs>
                
                            <template is="dom-repeat" items="{{parentModel.sections}}">
                                yyy
                                <grapp-breadcrumb href="{{baseUrl}}content-tree/{{item.data}}">[[item.key]]</grapp-breadcrumb>
                            </template>
                        </grapp-breadcrumbs>-->

                <grapp-breadcrumbs id="parentTocBc" render$="{{renderBreadCrumbs}}"></grapp-breadcrumbs>


                <h2>{{rootModel.title}}</h2>

                <!--<paper-card heading="{{rootModel.title}}">-->
                <iron-list items="{{data.sections}}" as="item"  hidden$="[[!data.sections.length]]">
                           <template>

                        <!--<iron-item>-->
                        <!--<template is="dom-if" if="{{isFork(item)}}">-->
                        <paper-item tabindex$="[[tabIndex]]">
                                    <paper-material>
                                <h3 title="Navigate to {{baseUrl}}content-tree/{{item.data}}"><a href$="{{baseUrl}}content-tree/{{item.data}}">[[item.key]]</a></h3>
                            </paper-material>
                        </paper-item>
                        <!--</template>-->
                        <!--</iron-item>-->
                    </template>
                </iron-list>
                <!--</paper-card>-->
            </div>
            
            <div id="drafts">
               
                <template is="dom-repeat" items="{{parentModel.sections}}">
                    <grapp-breadcrumb href="{{baseUrl}}content-tree/{{item.data}}">[[item.key]]</grapp-breadcrumb>
                </template>

                <grapp-breadcrumbs id="parentTocBc" render$="{{renderBreadCrumbs}}"></grapp-breadcrumbs>


                <h2>{{rootModel.title}}</h2>
                <iron-list items="{{data.sections}}" as="item"  hidden$="[[!data.sections.length]]">
                           <template>
                        <paper-item tabindex$="[[tabIndex]]">
                                    <paper-material>
                                <h3 title="Navigate to {{baseUrl}}content-tree/{{item.data}}"><a href$="{{baseUrl}}content-tree/{{item.data}}">[[item.key]]</a></h3>
                            </paper-material>
                        </paper-item>
                    </template>
                </iron-list>
            </div>
            
            <div id="published">
               
                <template is="dom-repeat" items="{{parentModel.sections}}">
                    <grapp-breadcrumb href="{{baseUrl}}content-tree/{{item.data}}">[[item.key]]</grapp-breadcrumb>
                </template>

                <grapp-breadcrumbs id="parentTocBc" render$="{{renderBreadCrumbs}}"></grapp-breadcrumbs>


                <h2>{{rootModel.title}}</h2>
                <iron-list items="{{data.sections}}" as="item"  hidden$="[[!data.sections.length]]">
                           <template>
                        <paper-item tabindex$="[[tabIndex]]">
                                    <paper-material>
                                <h3 title="Navigate to {{baseUrl}}content-tree/{{item.data}}"><a href$="{{baseUrl}}content-tree/{{item.data}}">[[item.key]]</a></h3>
                            </paper-material>
                        </paper-item>
                    </template>
                </iron-list>
            </div>
        </iron-pages>
    </template>
    <script>
        (function () {
            'use strict';

            Polymer({
                is: 'messages-view',
                behaviors: [PlutoniumBehaviors.WidgetBehavior],
                properties: {
                    tocRequestParams: {
                        type: Object,
                        notify: true,
                        value: {
                            pageId: null
                        }
                    },
                    infoRequestParams: {
                        type: Object,
                        notify: true,
                        value: {
                            pageId: null
                        }
                    },
                    renderBreadCrumbs: {
                        type: Boolean,
                        notify: true,
                        value: false
                    },
                    selectedContentFolder: {
                        type: Number,
                        notify: true,
                        selected: 0
                    },
                    selectedRoot: {
                        type: String,
                        notify: true,
                        value: 'ROOT'
                    },
                    baseUrl: {
                        type: String,
                        notify: true
                    },
                    rootModel: {
                        type: Object,
                        notify: true
                    },
                    parentModel: {
                        type: Object,
                        notify: true
                    },
                    ready: function () {
                        console.log('Toc-Content-view is READY(account-id=' + this.selectedRoot + ')');
                    }
                },
                observers: [
                    'computeTocRequestParams(selectedRoot)'
                ],
                computeTocRequestParams: function (selectedRoot) {
                    this.tocRequestParams.pageId = selectedRoot;
                    this.infoRequestParams.pageId = selectedRoot;
                    console.log('Toc-Content-view toc navigation request parameters updated: ' + JSON.stringify(this.tocRequestParams))
                    this.$.rootModelAjax.generateRequest();
                    this.$.childTocAjax.generateRequest();
                    this.$.parentTocAjax.generateRequest();
                },
                getItemClasses: function (item) {
                    return item.tags.join(" ");
                },
                isLeaf: function (item) {
                    console.log(item.sections.length);
                    return item.sections.length === 0;
                },
                isFork: function (item) {
                    return item.sections.length > 0;
                },
                onParentTocResponse: function () {
                    console.log('Toc-Content-View parent path request paramter success.');
                    this.renderBreadCrumbs = true;
                    this.$.parentTocBc.render = true;
                },
                onParentTocError: function () {
                    this.renderBreadCrumbs = true;
                },
            });
        })();
    </script>
</dom-module>
